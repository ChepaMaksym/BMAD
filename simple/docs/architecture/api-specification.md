# API Specification

## REST API Specification

```yaml
openapi: 3.0.0
info:
  title: User Event Hub API
  version: 1.0.0
  description: API for managing and submitting user-generated events for the User Event Hub.
servers:
  - url: https://api.usereventhub.com/v1
    description: Production User Event Hub API server
  - url: https://dev.api.usereventhub.com/v1
    description: Development User Event Hub API server

paths:
  /events/order:
    post:
      summary: Submit a new user event
      operationId: submitOrderEvent
      requestBody:
        description: Order event object to be submitted
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderEventRequest'
      responses:
        '202':
          description: Event successfully accepted for processing.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Event accepted for processing."
                  eventId:
                    type: string
                    format: uuid
                    example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        '400':
          description: Invalid event data provided.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid event data."
        '401':
          description: Unauthorized request.
        '403':
          description: Forbidden - Insufficient permissions.
      security:
        - azure_ad_b2c:
            - events.write

components:
  schemas:
    OrderEventRequest:
      type: object
      required:
        - userId
        - type
        - description
        - eventPayload
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the event. If not provided by client, will be generated by server.
          readOnly: true # Server will generate if not provided, or validate if provided.
        userId:
          type: string
          description: The identifier of the user who generated the event.
          example: "user123"
        type:
          type: string
          enum: ["PageView", "Click", "Purchase"]
          description: The type of event.
          example: "Purchase"
        description:
          type: string
          description: A detailed description of the event.
          example: "User purchased item XYZ"
        eventPayload:
          type: object
          nullable: true
          description: Additional, event-specific details in JSON format.
          example:
            productId: "P12345"
            quantity: 1
            price: 99.99
        createdAt:
          type: string
          format: date-time
          description: The date and time the event was created (ISO 8601). If not provided by client, will be generated by server.
          readOnly: true # Server will generate if not provided, or validate if provided.
    
  securitySchemes:
    azure_ad_b2c:
      type: oauth2
      description: Azure Active Directory B2C Authentication
      flows:
        implicit:
          authorizationUrl: https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/authorize
          tokenUrl: https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token
          scopes:
            events.write: Write access to events
            events.read: Read access to events
```

## API Versioning Strategy

To ensure backward compatibility and allow for future evolution of the API, the **URL Path Versioning** strategy will be adopted.

**Strategy:** Embedding the API version directly into the URL path.
-   **Example:** `GET /api/v1/events/order`, `GET /api/v2/events/order`
-   **Advantages:**
    -   **Simplicity and Discoverability:** Versions are clearly visible and easy for developers to understand and use.
    -   **Caching:** Different API versions are treated as distinct resources, supporting effective caching mechanisms.
    -   **Client Adoption:** Clients can easily adapt to new versions by updating the URL path.
-   **Implementation (ASP.NET Core):** ASP.NET Core API Versioning libraries will be used, allowing controllers to be attributed with `[ApiVersion("1.0")]`, `[ApiVersion("2.0")]`, etc., and enabling routing based on the URL segment.
-   **Implementation (Azure Functions):** Azure Functions HTTP triggers will define versioned routes (e.g., `/v1/events/order`, `/v2/events/order`).
